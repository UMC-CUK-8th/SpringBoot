    # ğŸ¯í•µì‹¬ í‚¤ì›Œë“œ

---

<aside>
ğŸ’¡ ì£¼ìš” ë‚´ìš©ë“¤ì— ëŒ€í•´ ì¡°ì‚¬í•´ë³´ê³ , ìì‹ ë§Œì˜ ìƒê°ì„ í†µí•´ ì •ë¦¬í•´ë³´ì„¸ìš”!
ë ˆí¼ëŸ°ìŠ¤ë¥¼ ì°¸ê³ í•˜ì—¬ ì •ì˜, ì†ì„±, ì¥ë‹¨ì  ë“±ì„ ì ì–´ì£¼ì…”ë„ ë©ë‹ˆë‹¤.
ì¡°ì‚¬ëŠ” ê³µì‹ í™ˆí˜ì´ì§€ **Best**, ë¸”ë¡œê·¸(ìµœì‹  ë‚ ì§œ) **Not Bad**

</aside>

- **ì§€ì—°ë¡œë”©ê³¼ ì¦‰ì‹œë¡œë”©ì˜ ì°¨ì´**
    
    
    | ì¢…ë¥˜ | ì§€ì—°ë¡œë”© | ì¦‰ì‹œë¡œë”© |
    | --- | --- | --- |
    | íŠ¹ì§• | ì—°ê´€ëœ ì—”í‹°í‹°ë¥¼ ì‹¤ì œ ì‚¬ìš©í•  ë•Œ ë¡œë”© | ì—°ê´€ëœ ì—”í‹°í‹°ë¥¼ ì¦‰ì‹œ ë¡œë”© |
    | ì¥ì  | ì„±ëŠ¥ ìµœì í™”(ë¶ˆí•„ìš”í•œ ë¡œë”©ì„ ë°©ì§€í•˜ì—¬ ì“¸ëŒ€ì—†ëŠ” ìì›ì‚¬ìš©X) | ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰ ê´€ë¦¬ |
    | ë‹¨ì  | N+1ë¬¸ì œ ê°€ëŠ¥ì„± ìˆìŒ | ë¶ˆí•„ìš”í•œ ì¿¼ë¦¬ ë°œìƒ ê°€ëŠ¥ |
    | ì„¤ì • | `@OneToMany(fetch = FetchType.LAZY)` | `@ManyToOne(fetch = FetchType.EAGER)` |
- **Fetch Join**
    
    SQLë¬¸ì˜ `Join` ê³¼ ë¹„ìŠ·í•˜ì§€ë§Œ ì—”í‹°í‹° ê°ì²´ë¥¼ ì¦‰ì‹œ ì´ˆê¸°í™” í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•œë‹¤. N+1 í•´ê²°ì— ë§¤ìš° ìœ ìš©í•˜ë‹¤.
    
    ì˜ˆì‹œ
    
    `@Query("SELECT s FROM Store s JOIN FETCH s.reviewList")
    List<Store> findAllWithReviews();`
    
- **@EntityGraph**
    
    Fetch Joinê³¼ ìœ ì‚¬í•œ ì—­í• ì„ JPQLì—†ì´ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•´ì¤Œ
    
    ì„ ì–¸í˜•ìœ¼ë¡œ í•„ìš”í•œ ì—°ê´€ê´€ê³„ë¥¼ fetch í•˜ë„ë¡ ì§€ì • ê°€ëŠ¥
    
    ì˜ˆì‹œ
    
    `@EntityGraph(attributePaths = {"reviewList"})
    List<Store> findAll();`
    
- **JPQL**
    
    SQLê³¼ ë¹„ìŠ·í•˜ì§€ë§Œ, ì—”í‹°í‹° ê°ì²´ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì‘ì„±í•  ìˆ˜ ìˆìŒ
    
    ì˜ˆì‹œ
    
    `@Query("SELECT s FROM Store s WHERE [s.name](http://s.name/) = :name")
    Store findByName(@Param("name") String name);`
    
- **QueryDSL**
    
    íƒ€ì…ì´ ì•ˆì „í•˜ê³  ë™ì  ì¿¼ë¦¬ì— ê°•í•¨. ë˜í•œ BooleanBuilderì™€ Qíƒ€ì…ì„ í™œìš©í•¨.
    
    `BooleanBuilder builder = new BooleanBuilder();
    if (score != null) builder.and(store.score.goe(score));`
    
    `queryFactory.selectFrom(store)
    .where(builder)
    .fetch();`
    
- **N+1 ë¬¸ì œ í•´ê²°ë°©ë²•**
    
    
    | í•´ê²° ë°©ë²• | ì„¤ëª… | íŠ¹ì§• |
    | --- | --- | --- |
    | **Fetch Join** | `@Query` ë˜ëŠ” JPQLì—ì„œ `join fetch` ì‚¬ìš© | ê°€ì¥ ì§ê´€ì ì´ë©° ì„±ëŠ¥ í–¥ìƒì— íš¨ê³¼ì  |
    | **@EntityGraph** | JPA ì—”í‹°í‹°ì—ì„œ ì—°ê´€ê´€ê³„ë¥¼ ì¦‰ì‹œ ë¡œë”©í•˜ë„ë¡ ì„¤ì • | ì¿¼ë¦¬ ë¶„ë¦¬ ì—†ì´ ê°„ê²°í•˜ê²Œ í‘œí˜„ |
    | **Hibernate batch_size** | ì—°ê´€ëœ ì—”í‹°í‹°ë“¤ì„ **IN ì¿¼ë¦¬ë¡œ ë¬¶ì–´ ë¡œë”©** | **ì»¬ë ‰ì…˜ ì¡°íšŒ**ì— ì í•© |
    | **JOIN + DTO ì§ì ‘ ì¡°íšŒ** | ì›í•˜ëŠ” í•„ë“œë§Œ ë½‘ì•„ì˜¤ëŠ” ì¿¼ë¦¬ë¥¼ ì‘ì„± | ì„±ëŠ¥ ìµœê³ , but ì½”ë“œ ë³µì¡ |
    | **QueryDSLì˜ fetchJoin()** | íƒ€ì… ì•ˆì •ì„±ê³¼ ì¡°ê±´ë¶€ ì¡°í•© ê°€ëŠ¥ | ì‹¤ë¬´ì—ì„œ ìì£¼ ì‚¬ìš©ë¨ |
    | **Spring Data JPA + @Query + fetch join** | ì»¤ìŠ¤í…€ Repositoryì— ëª…ì‹œì ìœ¼ë¡œ fetch join ì‘ì„± | ë³µì¡í•œ ì¡°ê±´ì— ìœ ë¦¬ |

## ğŸ“¢Â í•™ìŠµ í›„ê¸°

---

- ì´ë²ˆ ì£¼ì°¨ ì›Œí¬ë¶ì„ í•´ê²°í•´ë³´ë©´ì„œ ì–´ë• ëŠ”ì§€ íšŒê³ í•´ë´…ì‹œë‹¤.
- í•µì‹¬ í‚¤ì›Œë“œì— ëŒ€í•´ ì™„ë²½í•˜ê²Œ ì´í•´í–ˆëŠ”ì§€? í˜¹ì‹œ ì´í•´ê°€ ì•ˆ ë˜ëŠ” ë¶€ë¶„ì€ ë­ì˜€ëŠ”ì§€?

## âš ï¸Â ìŠ¤í„°ë”” ì§„í–‰ ë°©ë²•

---

1. ìŠ¤í„°ë””ë¥¼ ì§„í–‰í•˜ê¸° ì „, ì›Œí¬ë¶ ë‚´ìš©ë“¤ì„ ëª¨ë‘ ì±„ìš°ê³  ìŠ¤í„°ë””ì—ì„œëŠ” ì„œë¡œ ëª¨ë¥´ëŠ” ë‚´ìš©ë“¤ì„ ê³µìœ í•´ì£¼ì„¸ìš”.
2. ë¯¸ì…˜ì€ ì›Œí¬ë¶ ë‚´ìš©ë“¤ì„ ëª¨ë‘ ì™„ë£Œí•˜ê³  ë‚˜ì„œ ìŠ¤í„°ë”” ì „/í›„ë¡œ ì§„í–‰í•´ë³´ì„¸ìš”.
3. ë‹¤ìŒì£¼ ìŠ¤í„°ë””ë¥¼ ì§„í–‰í•˜ê¸° ì „, ì§€ë‚œì£¼ ë¯¸ì…˜ì„ ì„œë¡œ ê³µìœ í•´ì„œ ìƒí˜¸ í”¼ë“œë°±ì„ ì§„í–‰í•˜ì‹œë©´ ë©ë‹ˆë‹¤.

## âœ…Â ì‹¤ìŠµ ì²´í¬ë¦¬ìŠ¤íŠ¸

---

## â˜‘ï¸Â ì‹¤ìŠµ ì¸ì¦

---

`feature/week6` ë¸Œëœì¹˜ë¥¼ íŒ í›„ ì‹¤ìŠµ ì½”ë“œë¥¼ ì „ë¶€ ì²¨ë¶€í•˜ì—¬ ì§„í–‰í•´ì£¼ì„¸ìš”. 

## ğŸ”¥Â ë¯¸ì…˜

---

1. N+1 ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆëŠ” ì—¬ëŸ¬ ê°€ì§€ ë‹¤ë¥¸ ë°©ë²•ë“¤ì— ëŒ€í•´ ì¡°ì‚¬í•œ í›„, [ í•µì‹¬ í‚¤ì›Œë“œ ] ì— ì •ë¦¬
2. 2ì£¼ì°¨ ë¯¸ì…˜ ë•Œ í–ˆë˜ í•´ë‹¹ í™”ë©´ë“¤ì— ëŒ€í•´ ì‘ì„±í–ˆë˜ ì¿¼ë¦¬ë¥¼ QueryDSLë¡œ ì‘ì„±í•˜ì—¬ ë¦¬íŒ©í† ë§í•˜ê¸°

![ë‚´ê°€ ì§„í–‰ì¤‘, ì§„í–‰ ì™„ë£Œí•œ ë¯¸ì…˜ ëª¨ì•„ì„œ ë³´ëŠ” ì¿¼ë¦¬(í˜ì´ì§• í¬í•¨)](Untitled.png)

ë‚´ê°€ ì§„í–‰ì¤‘, ì§„í–‰ ì™„ë£Œí•œ ë¯¸ì…˜ ëª¨ì•„ì„œ ë³´ëŠ” ì¿¼ë¦¬(í˜ì´ì§• í¬í•¨)

![ë¦¬ë·° ì‘ì„±í•˜ëŠ” ì¿¼ë¦¬,
* ì‚¬ì§„ì˜ ê²½ìš°ëŠ” ì¼ë‹¨ ë°°ì œ](Untitled%201.png)

ë¦¬ë·° ì‘ì„±í•˜ëŠ” ì¿¼ë¦¬,
* ì‚¬ì§„ì˜ ê²½ìš°ëŠ” ì¼ë‹¨ ë°°ì œ

![í™ˆ í™”ë©´ ì¿¼ë¦¬
(í˜„ì¬ ì„ íƒ ëœ ì§€ì—­ì—ì„œ ë„ì „ì´ ê°€ëŠ¥í•œ ë¯¸ì…˜ ëª©ë¡, í˜ì´ì§• í¬í•¨)](Untitled%202.png)

í™ˆ í™”ë©´ ì¿¼ë¦¬
(í˜„ì¬ ì„ íƒ ëœ ì§€ì—­ì—ì„œ ë„ì „ì´ ê°€ëŠ¥í•œ ë¯¸ì…˜ ëª©ë¡, í˜ì´ì§• í¬í•¨)

![ë§ˆì´ í˜ì´ì§€ í™”ë©´ ì¿¼ë¦¬](Untitled%203.png)

ë§ˆì´ í˜ì´ì§€ í™”ë©´ ì¿¼ë¦¬

# ğŸ’ªÂ ë¯¸ì…˜ ê¸°ë¡

---

<aside>
ğŸ€ ë¯¸ì…˜ ê¸°ë¡ì˜ ê²½ìš°, ì•„ë˜ ë¯¸ì…˜ ê¸°ë¡ í† ê¸€ ì†ì— ì‘ì„±í•˜ì‹œê±°ë‚˜, í˜ì´ì§€ë¥¼ ìƒˆë¡œ ìƒì„±í•˜ì—¬ í•´ë‹¹ í˜ì´ì§€ì— ê¸°ë¡í•˜ì—¬ë„ ì¢‹ìŠµë‹ˆë‹¤!

í•˜ì§€ë§Œ, ê²°ê³¼ë¬¼ë§Œ ì˜¬ë¦¬ëŠ” ê²ƒì´ ì•„ë‹Œ, **ì¤‘ê°„ ê³¼ì • ëª¨ë‘ ê¸°ë¡í•˜ì…”ì•¼ í•œë‹¤ëŠ” ì !** ìŠì§€ ë§ì•„ì£¼ì„¸ìš”.

</aside>

- **ë¯¸ì…˜ ê¸°ë¡**
    
    ### 1. ë‚´ê°€ ì§„í–‰ì¤‘, ì§„í–‰ ì™„ë£Œí•œ ë¯¸ì…˜ ëª¨ì•„ì„œ ë³´ëŠ” ì¿¼ë¦¬(í˜ì´ì§• í¬í•¨)
    
    ê¸°ì¡´ì— ë‚´ê°€ ì‚¬ìš©í–ˆë˜ sqlë¬¸ ì¿¼ë¦¬
    
    ```sql
    select
        member_mission.id,
        member_mission.reward,
        mission.mission_spec,
        mission.price,
        store.name,
        member_mission.status,
        member_mission.updated_at,
        member.name,
        member.point
    from member_mission
    join mission on member_mission.mission_id = mission.id
    join store on store.id = mission.store_id
    join member on member_mission.member_id = member.id
    where member_mission.member_id = :memberId
    order by member_mission.updated_at desc
    limit 10 offset 0;
    ```
    
    **SqueryDSL ë³€í•œ**
    
    ```java
    public List<MemberMissionResponse> findMyMissions(Long memberId, int offset, int limit) {
        QMemberMission memberMission = QMemberMission.memberMission;
        QMission mission = QMission.mission;
        QStore store = QStore.store;
        QMember member = QMember.member;
    
        return queryFactory
            .select(Projections.constructor(MemberMissionResponse.class,
                memberMission.id,
                memberMission.reward,
                mission.missionSpec,
                mission.price,
                store.name,
                memberMission.status,
                memberMission.updatedAt,
                member.name,
                member.point
            ))
            .from(memberMission)
            .join(memberMission.mission, mission)
            .join(mission.store, store)
            .join(memberMission.member, member)
            .where(memberMission.member.id.eq(memberId))
            .orderBy(memberMission.updatedAt.desc())
            .offset(offset)
            .limit(limit)
            .fetch();
    }
    
    ```
    
    í•˜ì§€ë§Œ ì´ë ‡ê²Œ ê·¸ëŒ€ë¡œ í•˜ê²Œëœë‹¤ë©´ ì˜ˆë¥¼ë“¤ì–´ `MemberMission` ì—”í‹°í‹°ë¥¼ ê·¸ëŒ€ë¡œ ë°˜í™˜í•˜ê²Œë˜ì–´
    
    ```json
    {
      "id": 2,
      "status": "ì§„í–‰ì¤‘",
      "updatedAt": "2025-03-29T18:52:39",
      "mission": {
        "id": 1,
        "missionSpec": "ì‚¬ì§„ ì—…ë¡œë“œ ë¯¸ì…˜",
        "price": 4000,
        "store": {
          "id": 1,
          "name": "ê°€ê²Œì´ë¦„a",
          "address": "ì„œìš¸ì‹œ ì–´ë”˜ê°€",
          "createdAt": "2025-03-01T12:00:00",
          "updatedAt": "2025-03-01T12:10:00",
          ...
        },
        ...
      },
      "member": {
        "id": 2,
        "name": "í™ê¸¸ë™",
        "email": "í™ê¸¸ë™@naver.com",
        "password": "password",
        "point": 3200,
        ...
      }
    }
    
    ```
    
    ì´ë ‡ê²Œ êµ‰ì¥íˆ ë”ëŸ½ê³  ë³µì¡í•˜ê²Œ ë°˜í™˜í•˜ê²Œ ë¨. ê·¸ë˜ì„œ DTO íŒŒì¼ ì„¤ì • í•„ìˆ˜. ë˜í•œ
    
    - ë¶ˆí•„ìš”í•˜ê²Œ ê¹Šì€ ì—°ê´€ê´€ê³„ ë…¸ì¶œ
    - `password, email` ê°™ì€ ë¯¼ê°í•œ ì •ë³´ë“¤ë„ ë…¸ì¶œ
    - ë³´ì•ˆì˜ ìœ„í—™ì´ ìˆìŒ
    
    í•„ìš”í•œ ë°ì´í„°ë§Œ ì „ì†¡í•˜ê¸° ìœ„í•´ DTOíŒŒì¼ë¶€í„° ì„¤ì •í•´ì•¼í•¨.
    
    - ê³„ì¸µ ê°„ ì—­í•  ë¶„ë¦¬
    - QueryDSLì˜ ìµœì í™”ëœ ì¿¼ë¦¬ì‘ì„±
    - ë³´ì•ˆ
    
    ë“±ì˜ ì´ìœ ë„ í¬í•¨. ì•„ë˜ëŠ” 1ë²ˆë¬¸ì œë¥¼ ìœ„í•œ DTO ì½”ë“œì‘ã„±ì„±ë¬¸
    
    ```java
    package umc.study.dto;
    
    import lombok.AllArgsConstructor;
    import lombok.Data;
    
    import java.time.LocalDateTime;
    
    @Getter
    @AllArgsConstructor
    public class MemberMissionResponse {
        private Long id;               
        private Integer reward;       
        private String missionSpec;   
        private Integer price;        
        private String storeName;      
        private String status;         
        private LocalDateTime updatedAt; 
        private String memberName;     
        private Integer point;         
    }
    
    ```
    
    ê·¸ë¡œì¸í•œ ê¹”ë”í•œ ê²°ê³¼ë¬¼ ì¶œë ¥ ê°€ëŠ¥.
    
    ```json
    {
      "missionId": 1,
      "missionSpec": "ì‚¬ì§„ ì—…ë¡œë“œ ë¯¸ì…˜",
      "storeName": "ê°€ê²Œì´ë¦„a",
      "reward": 500,
      "status": "ì§„í–‰ì¤‘",
      "updatedAt": "2025-03-29T18:52:39"
    }
    
    ```
    
    ### 2. ë¦¬ë·° ì‘ì„±í•˜ëŠ” ì¿¼ë¦¬, * ì‚¬ì§„ì˜ ê²½ìš°ëŠ” ì¼ë‹¨ ë°°ì œ
    
    1ë²ˆì—ì„œ DTOë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ ë¥¼ ì ì—ˆìœ¼ë‹ˆ
    
    - ê¸°ì¡´ SQL ì¿¼ë¦¬
    - QueryDSL ë³€í™˜ë¬¸
    - DTO í´ë˜ìŠ¤
    - DTO ë¯¸ì‚¬ìš© ì‹œ ê²°ê³¼
    - DTO ì‚¬ìš© ì‹œ ê²°ê³¼
    
    ë¡œ ë‚˜ëˆ  ì ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤
    
    ### ë¦¬ë·° ì‘ì„±ìš© DTO
    
    ```java
    @Data
    @NoArgsConstructor
    @AllArgsConstructor
    public class CreateReviewRequest {
        private Long memberId;
        private Long storeId;
        private String body;
        private Float score;
    }
    
    ```
    
    ### ë¦¬ë·°ì‘ì„± Entity ì˜ˆ
    
    ```java
    @Entity
    public class Review {
    
        @Id @GeneratedValue(strategy = GenerationType.IDENTITY)
        private Long id;
    
        @ManyToOne(fetch = FetchType.LAZY)
        private Member member;
    
        @ManyToOne(fetch = FetchType.LAZY)
        private Store store;
    
        private String body;
    
        private Float score;
    
        private LocalDateTime createdAt;
        private LocalDateTime updatedAt;
    
        @PrePersist
        public void prePersist() {
            createdAt = LocalDateTime.now();
            updatedAt = LocalDateTime.now();
        }
    
        @PreUpdate
        public void preUpdate() {
            updatedAt = LocalDateTime.now();
        }
    }
    
    ```
    
    ### ReviewService ë©”ì„œë“œ
    ì»¤ìŠ¤í…€ í´ë˜ìŠ¤ ì œì‘

    ```java
        // com.example.exception íŒ¨í‚¤ì§€ì— ì €ì¥
    public class MemberNotFoundException extends RuntimeException {
        public MemberNotFoundException(Long memberId) {
            super("ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì‚¬ìš©ìì…ë‹ˆë‹¤. ID=" + memberId);
        }
    }

    public class StoreNotFoundException extends RuntimeException {
        public StoreNotFoundException(Long storeId) {
            super("ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê°€ê²Œì…ë‹ˆë‹¤. ID=" + storeId);
        }
    }
    ```
    
    
    ```java
    @RequiredArgsConstructor
    @Service
    @Transactional
    public class ReviewService {

        private final MemberRepository memberRepository;
        private final StoreRepository storeRepository;
        private final ReviewRepository reviewRepository;

        public void createReview(CreateReviewRequest dto) {
            Member member = memberRepository.findById(dto.getMemberId())
                .orElseThrow(() -> new MemberNotFoundException(dto.getMemberId()));

            Store store = storeRepository.findById(dto.getStoreId())
                .orElseThrow(() -> new StoreNotFoundException(dto.getStoreId()));

            Review review = Review.builder()
                .member(member)
                .store(store)
                .body(dto.getBody())
                .score(dto.getScore())
                .build();

            reviewRepository.save(review);
        }
    }


    ```
    
    ### ReviewController ì˜ˆì‹œ
    
    ```java
    @RestController
    @RequiredArgsConstructor
    @RequestMapping("/reviews")
    public class ReviewController {
    
        private final ReviewService reviewService;
    
        @PostMapping
        public ResponseEntity<Void> create(@RequestBody CreateReviewRequest request) {
            reviewService.createReview(request);
            return ResponseEntity.ok().build();
        }
    }
    
    ```
    
    `DTO`ë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ ëŠ” **í•„ìš”í•œ í•„ë“œë§Œ ë°›ê³ ** **ì—”í‹°í‹°ë¥¼ ìº¡ìŠí™”**í•´ì„œ ìœ ì§€ë³´ìˆ˜ì„±ì„ ë†’ì´ê¸° ìœ„í•´ì„œì…ë‹ˆë‹¤.
    
    ### 3. í™ˆ í™”ë©´ ì¿¼ë¦¬ (í˜„ì¬ ì„ íƒ ëœ ì§€ì—­ì—ì„œ ë„ì „ì´ ê°€ëŠ¥í•œ ë¯¸ì…˜ ëª©ë¡, í˜ì´ì§• í¬í•¨)
    
    1ë²ˆì—ì„œ DTOë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ ë¥¼ ì ì—ˆìœ¼ë‹ˆ
    
    - ê¸°ì¡´ SQL ì¿¼ë¦¬
    - QueryDSL ë³€í™˜ë¬¸
    - DTO í´ë˜ìŠ¤
    - DTO ë¯¸ì‚¬ìš© ì‹œ ê²°ê³¼
    - DTO ì‚¬ìš© ì‹œ ê²°ê³¼
    
    ë¡œ ë‚˜ëˆ  ì ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤
    
    ### ê¸°ì¡´ SQL ì¿¼ë¦¬
    
    ```sql
    SELECT 
        mission.id,
        mission.reward,
        mission.mission_spec,
        mission.price,
        store.name,
        DATEDIFF(mission.deadline, NOW()) AS d_day
    FROM mission
    JOIN store ON mission.store_id = store.id
    JOIN region ON store.region_id = region.id
    WHERE region.name = 'ì„œìš¸'
    ORDER BY mission.deadline DESC
    LIMIT 10 OFFSET 0;
    
    ```
    
    ### QueryDSL ë³€í™˜
    
    ```java
    public List<MissionSimpleDto> findMissionByRegion(String regionName, Pageable pageable) {
        QMission mission = QMission.mission;
        QStore store = QStore.store;
        QRegion region = QRegion.region;
    
        return queryFactory
                .select(Projections.constructor(MissionSimpleDto.class,
                        mission.id,
                        mission.reward,
                        mission.missionSpec,
                        mission.price,
                        store.name,
                        Expressions.numberTemplate(Integer.class, "DATEDIFF({0}, {1})", mission.deadline, LocalDateTime.now())
                ))
                .from(mission)
                .join(mission.store, store)
                .join(store.region, region)
                .where(region.name.eq(regionName))
                .orderBy(mission.deadline.desc())
                .offset(pageable.getOffset())
                .limit(pageable.getPageSize())
                .fetch();
    }
    
    ```
    
    ### DTO í´ë˜ìŠ¤
    
    ```java
    @Getter
    @AllArgsConstructor
    public class MissionSimpleDto {
        private Long id;
        private int reward;
        private String missionSpec;
        private int price;
        private String storeName;
        private int dDay;
    }
    
    ```
    
    ### DTO ì‚¬ìš© ì‹œ ë¬¸ì œ
    
    ```java
    List<Mission> missions = queryFactory
        .selectFrom(QMission.mission)
        .fetch();
    
    for (Mission m : missions) {
        System.out.println(m.getStore().getRegion().getName());
    }
    ì´ë ‡ê²Œ ì‚¬ìš©í•˜ê²Œ ë˜ë©´
    ```
    
    - N+1 ë¬¸ì œ ë°œìƒ: `store` ë˜ëŠ” `region`ì„ LAZYë¡œ ì„¤ì •í•´ë†¨ë‹¤ë©´ ì¶”ê°€ ì¿¼ë¦¬ ì—°ì† ë°œí–‰ë¨.
    - ë¶ˆí•„ìš”í•œ í•„ë“œ í¬í•¨: í”„ë¡ íŠ¸ì— í•„ìš” ì—†ëŠ” `BaseEntity`, `createdAt`, `updatedAt`, ë“± ë‹¤ ê°€ì ¸ì˜´.
    
    ### DTO ì‚¬ìš© ì‹œ í•´ê²°ë˜ëŠ” ê²ƒ
    
    - í•„ìš”í•œ í•„ë“œë§Œ ì¶”ì¶œí•´ì„œ ê°€ë³ê³  ê°„ë‹¨í•œ ì‘ë‹µ êµ¬ì¡° ìœ ì§€
    - join fetch ì•ˆ ì¨ë„ ë¬´ê´€: DTOì—ëŠ” ì§€ì—° ë¡œë”© ê±¸ë¦´ ê²Œ ì—†ìŒ
    - ì„±ëŠ¥ ìµœì í™” + ìœ ì§€ë³´ìˆ˜ ìš©ì´
    
    ### 4. ë§ˆì´ í˜ì´ì§€ í™”ë©´ ì¿¼ë¦¬
    
    ### ê¸°ì¡´ SQL ì¿¼ë¦¬
    
    ```sql
    SELECT
        member.name,
        member.email,
        CASE
            WHEN member.phone_number IS NULL THEN 'ë¯¸ì¸ì¦'
            ELSE member.phone_number
        END AS phone_number,
        member.point
    FROM member
    WHERE member.id = :id;
    
    ```
    
    ### QueryDSL ë³€í™˜
    
    ```java
    public MyPageInfoDto getMyPageInfo(Long memberId) {
        QMember member = QMember.member;
    
        return queryFactory
            .select(Projections.constructor(MyPageInfoDto.class,
                member.name,
                member.email,
                Expressions.stringTemplate(
                    "CASE WHEN {0} IS NULL THEN 'ë¯¸ì¸ì¦' ELSE {0} END",
                    member.phoneNumber
                ),
                member.point
            ))
            .from(member)
            .where(member.id.eq(memberId))
            .fetchOne();
    }
    
    ```
    
    ### DTOí´ë˜ìŠ¤ ì˜ˆì‹œ
    
    ```java
    public record MyPageInfoDto(
        String name,
        String email,
        String phoneNumber,
        int point
    ) {}
    
    ```
    
    ### DTOì—†ì´ ì§ì ‘ ì—”í‹°í‹° ë°˜í™˜ ì‹œ ìƒê¸°ëŠ” ë¬¸ì œ
    
    ```java
    public Member getMyPageInfo(Long memberId) {
        return queryFactory
            .selectFrom(QMember.member)
            .where(QMember.member.id.eq(memberId))
            .fetchOne();
    }
    ```
    
    - ë¶ˆí•„ìš”í•œ ì „ì²´ ë¡œë”©
    - ì—°ê´€ê´€ê³„ê°€ ë§ìœ¼ë©´ `N+1` ì´ìŠˆ ìœ ë°œ
    - ë¹„ë°€ë²ˆí˜¸, ìƒíƒœ ê°™ì€ í•„ë“œê°€ ë…¸ì¶œë˜ì–´ ë³´ì•ˆë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆìœ¼a
    
    ### DTO ì‚¬ìš© ì‹œ ì¢‹ì€ì 
    
    - í•„ìš”í•œ í•„ë“œë§Œ ì¶”ì¶œí•´ì„œ ê°€ë³ê³  ëª…í™•í•œ ì‘ë‹µ ê°€ëŠ¥
    - ì‘ë‹µ ê°ì²´ì˜ êµ¬ì¡°ê°€ ëª…í™•í•¨
    - API ëª…ì„¸ì„œì™€ ì¼ì¹˜í•˜ëŠ” í˜•íƒœë¡œ ì„¤ê³„ê°€ ìš©ì´í•¨.

[ì‹œë‹ˆì–´ ë¯¸ì…˜](%E1%84%89%E1%85%B5%E1%84%82%E1%85%B5%E1%84%8B%E1%85%A5%20%E1%84%86%E1%85%B5%E1%84%89%E1%85%A7%E1%86%AB%201e7b57f4596b816380afeb39f208539a.md)

## âš¡ íŠ¸ëŸ¬ë¸” ìŠˆíŒ…

---

<aside>
ğŸ’¡ ì‹¤ìŠµí•˜ë©´ì„œ ìƒê¸´ ë¬¸ì œë“¤ì— ëŒ€í•´ì„œ, **ì´ìŠˆ - ë¬¸ì œ - í•´ê²°** ìˆœì„œë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”.

</aside>

<aside>
ğŸ’¡ ìŠ¤ìŠ¤ë¡œ í•´ê²°í•˜ê¸° ì–´ë µë‹¤ë©´? ìŠ¤í„°ë””ì›ë“¤ì—ê²Œ ë„ì›€ì„ ìš”ì²­í•˜ê±°ë‚˜ **ë„ˆë””ë„ˆë¦¬ì˜ ì§€ì‹IN ì±„ë„ì— ì§ˆë¬¸**í•´ë³´ì„¸ìš”!

</aside>

- âš¡ì´ìŠˆ No.1~9
    
    **`ì´ìŠˆ`**
    
    ğŸ‘‰ [íŠ¸ëŸ¬ë¸”ì´ ìƒê¸´ ìƒíƒœ ì‘ì„±]
    
    **`ë¬¸ì œ`**
    
    ğŸ‘‰ [ì–´ë–¤ ì´ìœ ë¡œ í•´ë‹¹ ì´ìŠˆê°€ ì¼ì–´ë‚¬ëŠ”ì§€ ì‘ì„±]
    
    **`í•´ê²°`**
    
    ğŸ‘‰  [í•´ê²° ë°©ë²• ì‘ì„±]
    
    **`ì°¸ê³ ë ˆí¼ëŸ°ìŠ¤`**
    
    - [ë¬¸ì œ í•´ê²° ì‹œ ì°¸ê³ í•œ ë§í¬]

<aside>
ğŸ’¡

ì´ë²ˆì£¼ì°¨ ì›Œí¬ë¶ì„ í•˜ë©´ì„œ Javaë¥¼ ì œëŒ€ë¡œ ë°°ìš°ì§€ ëª»í•´ ì½”ë“œë¥¼ ì½ê³  ìˆ˜ì •í•˜ëŠ”ë° ë§ì€ ì–´ë ¤ì›€ì´ ìˆì—ˆìŠµë‹ˆë‹¤. íŠ¹íˆ ì œê°€ ë§Œë“  ERD êµ¬ì¡°ì™€ ì›Œí¬ë¶ì˜ êµ¬ì¡°ê°€ ë‹¬ë¼ ì œê³µí•´ì£¼ì‹  ì½”ë“œê°€ ëª¨ë‘ ì˜¤ë¥˜ê°€ ë–  ì¼ì¼ì´ ERDë¥¼ ìˆ˜ì •í•˜ëŠ” ì‹œê°„ì´ ë§ì´ ê±¸ë¦° ê±° ê°™ìŠµë‹ˆë‹¤. ì‹¤ìŠµì„ ì§„í–‰í•˜ë©° ìƒê¸´ ì˜¤ë¥˜ë“¤ì„ ëª¨ë‘ ì •ë¦¬í•´ë³´ê² ìŠµë‹ˆë‹¤.

### 1. QíŒŒì¼ì´ ì¤‘ë³µ ìƒì„±ë˜ëŠ” ì˜¤ë¥˜

- ì¦ìƒ: `Attempt to recreate a file for type QXXX` ì»´íŒŒì¼ ì—ëŸ¬ ë°œìƒ.
- ì›ì¸: QueryDSL QíŒŒì¼ì´ `src/main/java`ì—ë„ ìƒê¸°ê³ , `build/generated`ì—ë„ ì¤‘ë³µ ìƒì„±ë˜ì–´ ì¶©ëŒ.
- í•´ê²°:
    - QíŒŒì¼ ìƒì„± ë””ë ‰í† ë¦¬ë¥¼ í•˜ë‚˜ë¡œ í†µì¼.
    - `querydslDir`ì„ `build/generated/querydsl`ë¡œ ëª…ì‹œ í›„, `sourceSets`ì— ì¶”ê°€:
    
    `def querydslDir = "build/generated/querydsl"
    sourceSets {
    main {
    java {
    srcDirs += [querydslDir]
    }
    }
    }`
    
- ê²°ê³¼ë¬¼:

![image.png](image%206.png)

ì´ë ‡ê²Œ buildí´ë”ì— QíŒŒì¼ë“¤ì´ ë“¤ì–´ê°€ë„ë¡ ìˆ˜ì •í•˜ëŠ” ë¶€ë¶„ì—ì„œ ë§ì€ ì–´ë ¤ì›€ì´ ìˆì—ˆìŠµë‹ˆë‹¤.

### 2. QíŒŒì¼ì´ ì•ˆ ë§Œë“¤ì–´ì§€ëŠ” í˜„ìƒ

- ì¦ìƒ: `QXXX` í´ë˜ìŠ¤ê°€ ìƒì„±ë˜ì§€ ì•ŠìŒ.
- ì›ì¸: `annotationProcessorPath` ì„¤ì •ì´ ëˆ„ë½ë˜ì–´ ì»´íŒŒì¼ëŸ¬ê°€ ìƒì„± ëª»í•¨.
- í•´ê²°: ì•„ë˜ ì„¤ì • ì¶”ê°€:
    
    `tasks.named('compileJava') {
    options.annotationProcessorPath = configurations.querydsl
    }`
    

### 3. QíŒŒì¼ì´ build/generated ì™¸ ë‹¤ë¥¸ ìœ„ì¹˜ì— ìƒê¸°ë˜ ë¬¸ì œ

- ì›ì¸: QueryDSLì„ ë”°ë¡œ ì»´íŒŒì¼í•˜ëŠ” `compileQuerydsl` taskê°€ ëˆ„ë½ë˜ì–´ì„œ ê¸°ë³¸ ë¹Œë“œ ë£¨í‹´ ì•ˆì—ì„œ ì„ì˜ ìœ„ì¹˜ì— ìƒì„±.
- í•´ê²°: ëª…ì‹œì ìœ¼ë¡œ ìƒì„± ê²½ë¡œë¥¼ ì§€ì •í•œ Task ì‘ì„± ë° ë“±ë¡:
    - `tasks.register("compileQuerydsl", JavaCompile) {
    group = 'build'
    description = 'Compile QueryDSL Q-types'
    source = fileTree('src/main/java')
    classpath = configurations.querydsl
    destinationDirectory.set(file(querydslDir))
    options.annotationProcessorPath = configurations.querydsl
    }`
        
        `tasks.named('compileJava') {
        dependsOn tasks.named('compileQuerydsl')
        }`
        
    

### 4. `clean` ì´í›„ì—ë„ QíŒŒì¼ì´ ê³„ì† ë‚¨ëŠ” ë¬¸ì œ

- ì›ì¸: `clean` í•´ë„ generated ë””ë ‰í† ë¦¬ë¥¼ ì§ì ‘ ì‚­ì œí•˜ì§€ ì•Šìœ¼ë©´ QíŒŒì¼ì´ ë‚¨ìŒ.
- í•´ê²°:`clean.doFirst`ì— ëª…ì‹œì ìœ¼ë¡œ ì‚­ì œ ì‘ì—… ì¶”ê°€:
    - `clean.doFirst {
    delete file(querydslDir)
    }`

### 5.QueryDSL ì„¤ì • ì¶©ëŒ - annotationProcessorì™€ implementation

- ì¦ìƒ: QíŒŒì¼ì´ ìƒì„±ë˜ì§€ë§Œ ì¼ë¶€ ëª¨ë“ˆì—ã…”ì„œ ì¸ì‹ ëª»í•¨
- í•´ê²°:`annotationProcessor`ì™€ `implementation` ë‘˜ ë‹¤ jakarta ë²„ì „ìœ¼ë¡œ ì •í™•íˆ ì§€ì •:
    - `implementation 'com.querydsl:querydsl-jpa:5.0.0:jakarta'
    annotationProcessor 'com.querydsl:querydsl-apt:5.0.0:jakarta'
    annotationProcessor 'jakarta.annotation:jakarta.annotation-api'
    annotationProcessor 'jakarta.persistence:jakarta.persistence-api'`

### 6. MySql DBì—ì„œ ì œê³µí•´ì£¼ì‹  ë”ë¯¸ë°ì´í„° ì¶©ëŒ ë¬¸ì œ

### ğŸ’£ **MySQL Workbenchì—ì„œ ë°ì´í„° INSERT ì‹¤íŒ¨**

- **ë¬¸ì œ 1**: `Field 'reward' doesn't have a default value`
    - **ì›ì¸**: í…Œì´ë¸”ì— `NOT NULL` + `DEFAULT` ì—†ì´ ì»¬ëŸ¼ ìƒì„±ë¨.
        
        ![image.png](image%207.png)
        
    - **í•´ê²°**: `ALTER TABLE mission MODIFY reward int DEFAULT 0;`
        
        ![image.png](image%208.png)
        
- **ë¬¸ì œ 2**: `safe update mode`ë¡œ DELETE ì•ˆë¨ (Error 1175)
    
    ![image.png](image%209.png)
    
    - **í•´ê²°**: `SET SQL_SAFE_UPDATES = 0;` ì‹¤í–‰ í›„ ì‚­ì œ ê°€ëŠ¥.
- **ë¬¸ì œ 3**: `foreign key constraint fails` (Error 1451)
    - **ì„¤ëª…**: ì™¸ë˜í‚¤ê°€ ê±¸ë ¤ ìˆëŠ”ë° ë¶€ëª¨ í…Œì´ë¸”(region) ì‚­ì œ ì‹œë„.
        
        ![image.png](image%2010.png)
        
    - **í•´ê²°**: ì°¸ì¡° ê´€ê³„ ê³ ë ¤í•´ì„œ ìì‹ í…Œì´ë¸”ë¶€í„° DELETE.

### 7. **Qíƒ€ì…ì´ ì—†ì–´ ë°œìƒí•œ ì»´íŒŒì¼ ì˜¤ë¥˜**

- **í˜„ìƒ**: `QBaseEntity` ë“± `Qí´ë˜ìŠ¤` ê´€ë ¨ í´ë˜ìŠ¤ë“¤ì„ ì¸ì‹ ëª»í•¨.
- **ì›ì¸**: QíŒŒì¼ ìƒì„± ë””ë ‰í† ë¦¬ ë¬¸ì œ í˜¹ì€ build ì „ ë¯¸ìƒì„±.
- **ëŒ€ì‘**:
    - `gradlew clean build`ë¡œ ìˆ˜ë™ ìƒì„±.
    - `build/generated/querydsl` ë””ë ‰í† ë¦¬ë¥¼ IntelliJì—ì„œ *sources root*ë¡œ ì§€ì •.

### **8. EntityManager ì£¼ì… ì‹¤íŒ¨ (QueryDSLConfig)**

- **í˜„ìƒ**: `Cannot resolve bean of type 'EntityManager'` ì˜¤ë¥˜.
- **ì›ì¸**: JPA ì„¤ì • ë¯¸ì™„ë£Œ, í˜¹ì€ config í´ë˜ìŠ¤ê°€ ìŠ¤ìº”ë˜ì§€ ì•ŠìŒ.
- **í•´ê²°**:
    - `@Configuration`, `@RequiredArgsConstructor` ì„¤ì • í™•ì¸.
    - `@EnableJpaRepositories` ëˆ„ë½ ì—¬ë¶€ í™•ì¸.
    - JPA ì„¤ì • ì œëŒ€ë¡œ ë˜ë©´ ì‚¬ë¼ì§.

### **9. ë””ë ‰í† ë¦¬ êµ¬ì¡°/íŒ¨í‚¤ì§€ ë¬¸ì œ**

- `storeRepositoryImpl`, `storeRepositoryCustom` ë“±ì„ ìƒì„±í•  ë•Œ,
    - **interfaceì¸ì§€ classì¸ì§€** í—·ê°ˆë¦¼.
    - **íŒ¨í‚¤ì§€ ìœ„ì¹˜**ë¥¼ ì˜ëª» ì§€ì •í•´ì„œ `@ComponentScan` ëŒ€ìƒì—ì„œ ëˆ„ë½ë˜ê¸°ë„ í•¨.
        
        ![image.png](image%2011.png)
        
- **í•´ê²°**: íŒ¨í‚¤ì§€ êµ¬ì¡°ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ë‚˜ëˆ”
</aside>

## ğŸ¤”Â ì°¸ê³  ìë£Œ

---

Copyright Â© 2025 ì‹ ìˆ˜ì •(ë² ë‰´) All rights reserved.