# ì‹œë‹ˆì–´ ë¯¸ì…˜

**ë¯¸ì…˜ ëª©í‘œ:**

- **500 ì—ëŸ¬**ê°€ ë‚  ì‹œ **ìë™**ìœ¼ë¡œ **ë””ìŠ¤ì½”ë“œ(or ìŠ¬ë™)**ì— ì˜¬ë ¤ë³´ê¸°

**ë¯¸ì…˜ ì§„í–‰ ê³¼ì • ì •ë¦¬:**

1ï¸âƒ£Â **ë””ìŠ¤ì½”ë“œ/ìŠ¬ë™ ì›¹í›…(Webhook) ì„¤ì •**

- ë””ìŠ¤ì½”ë“œ í˜¹ì€ ìŠ¬ë™ì—ì„œ **Webhook URL ìƒì„±**.

2ï¸âƒ£ **ì˜ˆì™¸ í•¸ë“¤ëŸ¬ë¥¼ í†µí•´ 500 ì—ëŸ¬ ê°ì§€**

- `@ControllerAdvice` 500ì—ëŸ¬ë¥¼ íƒì§€í•˜ëŠ” ê³³ì— discordë‚˜ ìŠ¬ë™ì— ë³´ë‚´ëŠ” ì½”ë“œë¥¼ ì‘ì„±
- ë°œìƒí•œ ì˜ˆì™¸ ë©”ì‹œì§€, ìš”ì²­ URL, ë°œìƒ ì‹œê° ë“±ì˜ ì •ë³´ë¥¼ í¬í•¨í•œ **ì—ëŸ¬ ë¡œê·¸ í¬ë§· ì •ì˜**.
- **ë””ìŠ¤ì½”ë“œ**ë‚˜ **ìŠ¬ë™**ì— **POST ìš”ì²­**ì„ ë³´ë‚´ëŠ” **ì½”ë“œ ì‘ì„±** (ì´ë•Œ Webhook URLì´ ìœ ì¶œë˜ì§€ ì•Šê²Œê¸ˆ ì£¼ì˜í•œë‹¤.)

3ï¸âƒ£ **ì—ëŸ¬ ë°œìƒ ì‹œ ì•Œë¦¼ í…ŒìŠ¤íŠ¸**

- ê°•ì œë¡œ 500 ì—ëŸ¬ë¥¼ ë°œìƒì‹œí‚¤ëŠ” API ì—”ë“œí¬ì¸íŠ¸ë¥¼ êµ¬í˜„í•˜ê³  **ì •ìƒì ìœ¼ë¡œ ì•Œë¦¼ì´ ì „ì†¡ë˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸**.

4ï¸âƒ£Â **ê°œë°œ ì„œë²„, ë¡œì»¬ ì„œë²„** ì•Œë¦¼ ë¶„ë¦¬

- **ê°œë°œ ì„œë²„(or ìš´ì˜ ì„œë²„) í™˜ê²½**ì—ì„œë§Œ ì•Œë¦¼ì´ ì˜¤ë„ë¡ **ì„¤ì •**
    - ë§Œì•½ ë¡œì»¬ ì„œë²„ì—ì„œ ë‚œ ì—ëŸ¬ë„ ì•Œë¦¼ì´ ê°€ê²Œ í•œë‹¤ë©´ íŒ€ í˜‘ì—… ì‹œ ì–´ë– í•œ ì¼ì´ ì¼ì–´ë‚  ì§€ ìƒê° í•´ë³¸ë‹¤.

-ì›¹í›… ìƒì„±

```yaml
# application-prod.yml (ìš´ì˜ í™˜ê²½ë§Œ ì•Œë¦¼ ë°œì†¡)
error:
  notify:
    webhook-url: ${Webhook_Url}

```

-ë””ìŠ¤ì½”ë“œ ì „ì†¡ ì½”ë“œ

```java
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.http.*;
import org.springframework.stereotype.Component;
import org.springframework.web.client.RestTemplate;

import java.time.LocalDateTime;
import java.util.HashMap;
import java.util.Map;

@Slf4j
@Component
@RequiredArgsConstructor
public class DiscordNotifier {

    @Value("${error.notify.webhook-url}")
    private String webhookUrl;

    private final RestTemplate restTemplate = new RestTemplate();

    public void sendErrorNotification(Exception e, String requestUri) {
        try {
            String message = """
                    ğŸš¨ **500 Error ë°œìƒ**
                    ğŸ“ URL: %s
                    ğŸ•’ ì‹œê°„: %s
                    ğŸ§¾ ì˜ˆì™¸: `%s`
                    """.formatted(requestUri, LocalDateTime.now(), e.getMessage());

            Map<String, String> payload = new HashMap<>();
            payload.put("content", message);

            HttpHeaders headers = new HttpHeaders();
            headers.setContentType(MediaType.APPLICATION_JSON);

            HttpEntity<Map<String, String>> entity = new HttpEntity<>(payload, headers);
            restTemplate.postForEntity(webhookUrl, entity, String.class);

        } catch (Exception ex) {
            log.error("ë””ìŠ¤ì½”ë“œ ì•Œë¦¼ ì „ì†¡ ì‹¤íŒ¨", ex);
        }
    }
}

```

-ì˜ˆì™¸ í•¸ë“¤ëŸ¬

```java
@Slf4j
@RestControllerAdvice
public class GlobalExceptionHandler {

    private final DiscordNotifier discordNotifier;
    private final String activeProfile;

    public GlobalExceptionHandler(DiscordNotifier discordNotifier,
                                   @Value("${spring.profiles.active:default}") String activeProfile) {
        this.discordNotifier = discordNotifier;
        this.activeProfile = activeProfile;
    }

    @ExceptionHandler(CustomException.class)
    public ResponseEntity<ErrorResponse> handleCustomException(CustomException e) {
        ErrorResponse response = ErrorResponse.builder()
                .errorCode(e.getErrorCode())
                .message(e.getMessage())
                .build();

        log.warn("{}", e.getMessage());
        return ResponseEntity.status(e.getStatus()).body(response);
    }

    @ExceptionHandler(Exception.class)
    public ResponseEntity<ErrorResponse> handleException(Exception e, HttpServletRequest request) {
        ErrorResponse response = ErrorResponse.builder()
                .errorCode(BaseErrorCode.INTERNAL_SERVER_ERROR)
                .message(BaseErrorCode.INTERNAL_SERVER_ERROR.getMessage())
                .build();

        log.error("Exception is occurred.", e);

        // ìš´ì˜ í™˜ê²½ì¼ ë•Œë§Œ ë””ìŠ¤ì½”ë“œ ì•Œë¦¼
        if ("prod".equals(activeProfile)) {
            discordNotifier.sendErrorNotification(e, request.getRequestURI());
        }

        return ResponseEntity.status(response.getErrorCode().getStatus()).body(response);
    }
}

```

-í…ŒìŠ¤íŠ¸ api

```java
@RestController
@RequestMapping("api/test")
public class TestController {

    @GetMapping("/error")
    public void throwError() {
        throw new RuntimeException("500 ì—ëŸ¬ ë°œìƒ");
    }
}

```

-ë¡œì»¬ ì„œë²„ ì—ëŸ¬ê°€ ì•Œë¦¼ì´ ê°„ë‹¤ë©´?

ë°˜ë³µëœ í…ŒìŠ¤íŠ¸ ê³¼ì •ì—ì„œ ì˜¤ë¥˜ê°€ ê³„ì† ë°œìƒí• í…ë° ì“¸ëª¨ì—†ëŠ” ì•Œë¦¼ í­íƒ„ ê°€ëŠ¥.

ìš´ì˜/ê°œë°œ í™˜ê²½ ì—ëŸ¬ êµ¬ë¶„ì´ ì–´ë ¤ì›Œì§ˆ ìˆ˜ ìˆìŒ

 ë¡œì»¬ í…ŒìŠ¤íŠ¸ ì¤‘ ì—ëŸ¬ë‚˜ ë°ì´í„°ê°€ ì „ì†¡ë˜ë©´ ì˜ë„ì¹˜ ì•Šì€ ë‚´ë¶€ ì •ë³´ ìœ ì¶œ ê°€ëŠ¥