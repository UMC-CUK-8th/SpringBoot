

## ğŸ¯í•µì‹¬ í‚¤ì›Œë“œ

---

<aside>
ğŸ’¡ ì£¼ìš” ë‚´ìš©ë“¤ì— ëŒ€í•´ ì¡°ì‚¬í•´ë³´ê³ , ìì‹ ë§Œì˜ ìƒê°ì„ í†µí•´ ì •ë¦¬í•´ë³´ì„¸ìš”!
ë ˆí¼ëŸ°ìŠ¤ë¥¼ ì°¸ê³ í•˜ì—¬ ì •ì˜, ì†ì„±, ì¥ë‹¨ì  ë“±ì„ ì ì–´ì£¼ì…”ë„ ë©ë‹ˆë‹¤.
ì¡°ì‚¬ëŠ” ê³µì‹ í™ˆí˜ì´ì§€ **Best**, ë¸”ë¡œê·¸(ìµœì‹  ë‚ ì§œ) **Not Bad**

</aside>

- **ì§€ì—°ë¡œë”©ê³¼ ì¦‰ì‹œë¡œë”©ì˜ ì°¨ì´**
    
    
    ì¦‰ì‹œ ë¡œë”©ì€ **ì—°ê´€ëœ ì—”í‹°í‹°ë¥¼ ì¦‰ì‹œ**(ì¦‰, í˜„ì¬ ì¿¼ë¦¬ ì‹¤í–‰ ì‹œ) **í•¨ê»˜ ê°€ì ¸ì˜¤ëŠ” ë°©ì‹**ì…ë‹ˆë‹¤. `@ManyToOne`, `@OneToOne` ê´€ê³„ì—ì„œ ê¸°ë³¸ê°’ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ë¡œë”© ë°©ì‹ì…ë‹ˆë‹¤.
    
    ì¦‰ì‹œë¡œë”©(eager ë¡œë”©) 
    Manytooneì˜ ê²½ìš° ê¸°ë³¸ì ìœ¼ë¡œ Eagerë¡œë”©(ì¦‰ì‹œë¡œë”©)ë°©ì‹ìœ¼ë¡œ ë™ì‘í•œë‹¤ 
    joinì„ í•˜ê²Œë˜ë©´ ì—¬ëŸ¬í…Œì´ë¸”ì´ ì—®ì—¬ìˆì„ ìˆ˜ ìˆë‹¤ â‡’ ì„±ëŠ¥ ì €í•˜
    ëª¨ë“  ë°ì´í„°ë² ì´ìŠ¤ê°€ ë‹¨ì¼ ì¿¼ë¦¬ì—ì„œ ê²€ìƒ‰ë‹¤ìŒ ìºì‹œë˜ì–´ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„±ëŠ¥ í–¥ìƒ ê°€ëŠ¥ í•˜ì§€ë§Œ ëª¨ë“  ë°ì´í„°ë¥¼ ë‹¨ì¼ ì¿¼ë¦¬ì—ì„œ ë¡œë“œí•˜ê¸° ë•Œë¬¸ì— ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ì¦ê°€í•˜ê³  ê·¸ë§Œí¼ ë¦¬ìŠ¤í¬ê°€ ì¦ê°€í•¨
    
    ì§€ì—°ë¡œë”©(Lazyë¡œë”©)
    
    ë‚´ê°€ í•„ìš”í•˜ì§€ ì•Šìœ¼ë©´ ì¡°íšŒí•˜ì§€ ì•ŠëŠ” ê²ƒì´ë‹¤ ì¦‰ í•„ìš”í•œ ë‚´ìš©ì˜ í…Œì´ë¸”ë§Œ ì‚¬ìš©í•´ì„œ ì—®ì—¬ìˆëŠ” í…Œì´ë¸”ì€ ì œì™¸í•˜ê³  ì¡°íšŒí•œë‹¤  â‡’ ì„±ëŠ¥ í–¥ìƒ
    
    ì§€ì—°ë¡œë”©ì—ì„œëŠ” ì´ˆê¸° ë°ì´í„°ì™€ ê´€ë ¨ëœ ì¶”ê°€ ë°ì´í„°ê°€ í•„ìš”í•  ë•Œ ë‹¨ì¼ ì¿¼ë¦¬ì—ì„œ í•„ìš”í•œ ì–‘ì˜ ë°ì´í„°ë§Œ ê²€ìƒ‰í•œë‹¤. â‡’ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ì™€ ë°ì´í„°ë² ì´ìŠ¤ ì„œë²„ ê°„ì— ì—¬ëŸ¬ë²ˆì˜ ì™•ë³µì´ ìˆìŒì„ ì˜ë¯¸í•œë‹¤ ëŒ€ë¶€ë¶„ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì£¼ìš” ì„±ëŠ¥ ë³‘ëª© í˜„ìƒì´ë‹¤. ì™•ë³µì´ ì ì„ ìˆ˜ë¡ ì„±ëŠ¥ì´ ì¢‹ì•„ì§„ë‹¤
    
- **Fetch Join**
    
    **ì§€ì—° ë¡œë”©(Lazy Loading)ì˜ N+1** ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ **JPQL (Java Persistence Query Language)** ê¸°ëŠ¥ìœ¼ë¡œ ë°ì´í„°ë² ì´ìŠ¤ì˜ **ì—°ê´€ëœ ì—”í‹°í‹°ë¥¼ í•œ ë²ˆì˜ ì¿¼ë¦¬ë¡œ í•¨ê»˜ ê°€ì ¸ì˜¤ë„ë¡** ë§Œë“œëŠ” ë°©ë²•
    ì¦‰ jpqlì—ì„œ  ì„±ëŠ¥ìµœì í™”ë¥¼ìœ„í•´ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ìœ¼ë¡œ íŒ¨ì¹˜ì¡°ì¸ì„ ì‚¬ìš©í•˜ë©´ ì—°ê´€ëœ ì—”í‹°í‹°ë‚˜ ì»¬ë ‰ì…˜ì„ í•œë²ˆì— ì¡°íšŒí•  ìˆ˜ ìˆì–´ì„œ ê¸€ë¡œë²Œ ë¡œë”©ì „ëµì„ ì§€ì—°ë¡œë”©ìœ¼ë¡œ ì„¤ì •í–ˆì„ë•Œ íŒ¨ì¹˜ì¡°ì¸ë„ ê°™ì´ ì„¤ì •í•˜ë©´ ì„±ëŠ¥ì„ í–¥ìƒ ìˆ˜ ìˆê¸°ì— íŒ¨ì¹˜ì¡°ì¸ì„ ì‚¬ìš©í•˜ëŠ” ì´ìœ ì´ë‹¤.
    N+1ë¬¸ì œ í•´ê²° ë°©ì•ˆ : 
     Fetch Join â‡’ ì—°ê´€ëœ ì—”í‹°í‹°ë‚˜ ì»¬ë ‰ì…˜ì„ í•œ ë²ˆì— ê°™ì´ ì¡°íšŒí•˜ëŠ” ê¸°ëŠ¥ìœ¼ë¡œ JPQLì—ì„œ ì—°ê´€ ì—”í‹°í‹°ë¥¼ ì¦‰ì‹œ ë¡œë”©
    
- **@EntityGraph**
    
    
    JPAì—ì„œ **ì§€ì—° ë¡œë”©(LAZY)** ë¬¸ì œë¥¼ í•´ê²°í•˜ê±°ë‚˜, **ë³µì¡í•œ ì¿¼ë¦¬ ì—†ì´ ì—°ê´€ëœ ì—”í‹°í‹°ë¥¼ í•œ ë²ˆì— ë¡œë”©**í•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©í•˜ëŠ” ê¸°ëŠ¥ìœ¼ë¡œ ê°œë°œìê°€ ì—°ê´€ ì—”í‹°í‹°ë“¤ì„ í•¨ê»˜ ë¡œë”© í•  ê²ƒì¸ì§€ ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ëª…ì‹œí•˜ê³  í•´ë‹¹í•˜ëŠ” ì—”í‹°í‹°ëŠ” eager ë¡œë”© ë°©ì‹ìœ¼ë¡œ ì§„í–‰ëœë‹¤.
    N+1ë¬¸ì œ í•´ê²° ë°©ì•ˆ :  ë¯¸ë¦¬ ì„¤ì •í•œ í…Œì´ë¸”ì„ ê°€ì ¸ì˜¤ê²Œ ì„¤ì •í•¨ìœ¼ë¡œ JPAì—ê²Œ ë¯¸ë¦¬ ì•Œë ¤ì£¼ëŠ” ê²ƒì´ë‹¤. ê·¸ë ‡ê¸°ì— ë‚˜ì¤‘ì— LAZY ë•Œë¬¸ì— ì¶”ê°€ ì¿¼ë¦¬ë¥¼ ë‚ ë¦¬ëŠ” ê±¸ ë°©ì§€í•  ìˆ˜ ìˆë‹¤.
    
- **JPQL**
    
    JPQLì€ **JPA ì „ìš© ì¿¼ë¦¬ ì–¸ì–´**ë¡œ ê°ì²´ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ì‘ì„±í•œë‹¤. ê±°ì˜ sqlë¬¸ë²•ê³¼ ë¹„ìŠ·í•˜ì§€ë§Œ ì¤‘ìš”í•œ ì°¨ì´ì ì€ JPQLì€ ì—”í‹°í‹°ì™€ í•„ë“œê°€ ê¸°ì¤€ìœ¼ë¡œ ì‘ì„±ëœë‹¤. ê·¸ì™¸ ë¬¸ë²•ìì²´ëŠ” sqlê³¼ ë™ì¼í•˜ë‹¤
    
- **QueryDSL**
    
    QueryDSLì€ ì •ì  íƒ€ì…(=IDE ìë™ì™„ì„±) ê¸°ë°˜ì˜ JPQL ë¹Œë”ë¡œ ê¸°ì¡´ JPQLì€ ì˜¤íƒ€ë‚˜ í•„ë“œ ë³€ê²½ì‹œ ëŸ°íƒ€ì„ ì˜¤ë¥˜ì´ê¸°ì— ë””ë²„ê¹…í•˜ê¸° ë²ˆê±°ë¡­ê³  ë³µì¡í•œ ì¡°ê±´ë¬¸ ì²˜ë¦¬ì— ì–´ë ¤ì›€ì´ ìˆê¸°ì— QueryDSLì€ ìœ ì§€ë³´ìˆ˜ ì¸¡ë©´ì—ì„œ ì´ì ì´ ìˆë‹¤. ìë°”ì½”ë“œë¡œ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ê¸°ì— ê°€ë…ì„± í–¥ìƒì´ ë˜ê³ , íƒ€ì… ì•ˆì •ì„± í™•ë³´ (ì»´íŒŒì¼ íƒ€ì„ ì˜¤ë¥˜ íƒì§€), DTO ë§¤í•‘ ë“± ì—¬ëŸ¬ ê¸°ëŠ¥ì„ ì§€ì›í•œë‹¤.
    N+1ë¬¸ì œ í•´ê²° ë°©ì•ˆ : **ì—°ê´€ëœ ì—”í‹°í‹°ë¥¼ í•œ ë²ˆì˜ ì¿¼ë¦¬ë¡œ ê°€ì ¸ì˜¤ëŠ” ë°©ì‹**ì„ ì‚¬ìš©í•´ì„œ í•´ê²°ê°€ëŠ¥
    

## ğŸ“¢Â í•™ìŠµ í›„ê¸°

---

- ì´ë²ˆ ì£¼ì°¨ ì›Œí¬ë¶ì„ í•´ê²°í•´ë³´ë©´ì„œ ì–´ë• ëŠ”ì§€ íšŒê³ í•´ë´…ì‹œë‹¤.
- í•µì‹¬ í‚¤ì›Œë“œì— ëŒ€í•´ ì™„ë²½í•˜ê²Œ ì´í•´í–ˆëŠ”ì§€? í˜¹ì‹œ ì´í•´ê°€ ì•ˆ ë˜ëŠ” ë¶€ë¶„ì€ ë­ì˜€ëŠ”ì§€?

<aside>
ğŸ’¡

</aside>

## âš ï¸Â ìŠ¤í„°ë”” ì§„í–‰ ë°©ë²•

---

1. ìŠ¤í„°ë””ë¥¼ ì§„í–‰í•˜ê¸° ì „, ì›Œí¬ë¶ ë‚´ìš©ë“¤ì„ ëª¨ë‘ ì±„ìš°ê³  ìŠ¤í„°ë””ì—ì„œëŠ” ì„œë¡œ ëª¨ë¥´ëŠ” ë‚´ìš©ë“¤ì„ ê³µìœ í•´ì£¼ì„¸ìš”.
2. ë¯¸ì…˜ì€ ì›Œí¬ë¶ ë‚´ìš©ë“¤ì„ ëª¨ë‘ ì™„ë£Œí•˜ê³  ë‚˜ì„œ ìŠ¤í„°ë”” ì „/í›„ë¡œ ì§„í–‰í•´ë³´ì„¸ìš”.
3. ë‹¤ìŒì£¼ ìŠ¤í„°ë””ë¥¼ ì§„í–‰í•˜ê¸° ì „, ì§€ë‚œì£¼ ë¯¸ì…˜ì„ ì„œë¡œ ê³µìœ í•´ì„œ ìƒí˜¸ í”¼ë“œë°±ì„ ì§„í–‰í•˜ì‹œë©´ ë©ë‹ˆë‹¤.

## âœ…Â ì‹¤ìŠµ ì²´í¬ë¦¬ìŠ¤íŠ¸

---

## â˜‘ï¸Â ì‹¤ìŠµ ì¸ì¦

---

`feature/week6` ë¸Œëœì¹˜ë¥¼ íŒ í›„ ì‹¤ìŠµ ì½”ë“œë¥¼ ì „ë¶€ ì²¨ë¶€í•˜ì—¬ ì§„í–‰í•´ì£¼ì„¸ìš”. 

## ğŸ”¥Â ë¯¸ì…˜

---

1. N+1 ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆëŠ” ì—¬ëŸ¬ ê°€ì§€ ë‹¤ë¥¸ ë°©ë²•ë“¤ì— ëŒ€í•´ ì¡°ì‚¬í•œ í›„, [ í•µì‹¬ í‚¤ì›Œë“œ ] ì— ì •ë¦¬
2. 2ì£¼ì°¨ ë¯¸ì…˜ ë•Œ í–ˆë˜ í•´ë‹¹ í™”ë©´ë“¤ì— ëŒ€í•´ ì‘ì„±í–ˆë˜ ì¿¼ë¦¬ë¥¼ QueryDSLë¡œ ì‘ì„±í•˜ì—¬ ë¦¬íŒ©í† ë§í•˜ê¸°

![ë‚´ê°€ ì§„í–‰ì¤‘, ì§„í–‰ ì™„ë£Œí•œ ë¯¸ì…˜ ëª¨ì•„ì„œ ë³´ëŠ” ì¿¼ë¦¬(í˜ì´ì§• í¬í•¨)](Untitled.png)

ë‚´ê°€ ì§„í–‰ì¤‘, ì§„í–‰ ì™„ë£Œí•œ ë¯¸ì…˜ ëª¨ì•„ì„œ ë³´ëŠ” ì¿¼ë¦¬(í˜ì´ì§• í¬í•¨)

2ì£¼ì°¨ ì¿¼ë¦¬ë¬¸

SELECT ump.mission_name, ump.status FROM user_mission_pointcounter ump
JOIN member m ON m.phone_number = ump.phone_number
JOIN mission miss ON miss.mission_name = ump.mission_name WHERE ump.created_at <- (SELECT created_at FROM user_mission_pointcounter WHERE ____â†(ì´ë¶€ë¶„ì— í™”ë©´ì—ì„œ ì´ë¯¸ ë‚˜ì™€ìˆëŠ” ê°€ì¥ ëŠ¦ì€ created_atì„ ë„£ëŠ”ë‹¤ )) ORDER BY ump.created_at DESC LIMIT 20;

---

ì¿¼ë¦¬dsl

```java
@Repository
@RequiredArgsConstructor
public class UmpRepositoryImpl implements UmpRepositoryCustom {
    private final JPAQueryFactory jpaQueryFactory;
    private final QUserMissionPointcounter ump  = QUserMissionPointcounter.userMissionPointcounter;
    QMember member = QMember.member;
    QMission mission = QMission.mission;

    //@Override
    public List<UmpFirstDTO> firstpictureWithCursor(LocalDateTime cursorCreatedAt) {
        BooleanBuilder predicate = new BooleanBuilder();

        if (cursorCreatedAt != null) {
            predicate.and(ump.createdAt.lt(cursorCreatedAt)); // ì»¤ì„œ ì¡°ê±´
        }

        return jpaQueryFactory
                .select(Projections.constructor(UmpFirstDTO.class, ump.phonenumberMissionid, ump.status))
                .from(ump)
                .join(ump.member, member).on(member.phoneNumber.eq(ump.member.phoneNumber))
                .join(ump.mission, mission).on(mission.missionid.eq(ump.mission.missionid))
                .where(predicate)
                .orderBy(ump.createdAt.desc())
                .limit(20)
                .fetch();
    }
}
```

![ë¦¬ë·° ì‘ì„±í•˜ëŠ” ì¿¼ë¦¬,
* ì‚¬ì§„ì˜ ê²½ìš°ëŠ” ì¼ë‹¨ ë°°ì œ](Untitled%201.png)

ë¦¬ë·° ì‘ì„±í•˜ëŠ” ì¿¼ë¦¬,
* ì‚¬ì§„ì˜ ê²½ìš°ëŠ” ì¼ë‹¨ ë°°ì œ

2ì£¼ì°¨ ì¿¼ë¦¬ë¬¸

SELECT rv.title, rv.score, rv.description, rv.reply FROM review rv
JOIN member m ON rv.phone_number = m.phone_number
GROUP BY rv.phone_number

---

ì¿¼ë¦¬dsl

```java
package umc.study.repository.ReviewRepository;

import com.querydsl.core.types.Projections;
import com.querydsl.jpa.impl.JPAQueryFactory;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Repository;
import umc.study.domain.QMember;
import umc.study.domain.mapping.QReview;
import umc.study.dto.ReviewDTO;

import java.util.List;

@Repository
@RequiredArgsConstructor
public class ReviewRepositoryImpl implements ReviewRepositoryCustom {
    private final JPAQueryFactory jpaQueryFactory;
    private final QReview rv  = QReview.review;
    QMember member = QMember.member;

    //@Override
    public List<ReviewDTO> secondpicture(String title, int score,
                                                          String reply, String description) {

        return jpaQueryFactory
                .select(Projections.bean(ReviewDTO.class,
                        rv.title, rv.score, rv.description, rv.reply))
                .from(rv)
                .join(member).on(member.phoneNumber.eq(rv.member.phoneNumber))
                .orderBy(rv.member.phoneNumber.asc())
                .fetch();
    }
}
```

![í™ˆ í™”ë©´ ì¿¼ë¦¬
(í˜„ì¬ ì„ íƒ ëœ ì§€ì—­ì—ì„œ ë„ì „ì´ ê°€ëŠ¥í•œ ë¯¸ì…˜ ëª©ë¡, í˜ì´ì§• í¬í•¨)](Untitled%202.png)

í™ˆ í™”ë©´ ì¿¼ë¦¬
(í˜„ì¬ ì„ íƒ ëœ ì§€ì—­ì—ì„œ ë„ì „ì´ ê°€ëŠ¥í•œ ë¯¸ì…˜ ëª©ë¡, í˜ì´ì§• í¬í•¨)

2ì£¼ì°¨ ì¿¼ë¦¬ë¬¸

SELECT ump.completed_mission, miss.store_name, miss.created_at
FROM user_mission_pointcounter ump
JOIN mission miss ON miss.store_name=ump.store_name
WHERE miss.created_at < (SELECT created_at FROM mission WHERE ____â†(ì´ë¶€ë¶„ì— í™”ë©´ì—ì„œ ì´ë¯¸ ë‚˜ì™€ìˆëŠ” ê°€ì¥ ëŠ¦ì€ created_atì„ ë„£ëŠ”ë‹¤ ))
ORDER BY miss.created_at DESC LIMIT 20;

---

ì¿¼ë¦¬dsl

```java
package umc.study.repository.UserMemberPointcounterRepository;

import com.querydsl.core.BooleanBuilder;
import com.querydsl.core.types.Projections;
import com.querydsl.jpa.impl.JPAQueryFactory;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Repository;
import umc.study.domain.QMember;
import umc.study.domain.QMission;
import umc.study.domain.mapping.QUserMissionPointcounter;
import umc.study.dto.UmpFirstDTO;
import umc.study.dto.UmpThirdDTO;

import java.time.LocalDateTime;
import java.util.List;

@Repository
@RequiredArgsConstructor
public class UmpRepositoryImpl implements UmpRepositoryCustom {
    private final JPAQueryFactory jpaQueryFactory;
    private final QUserMissionPointcounter ump  = QUserMissionPointcounter.userMissionPointcounter;
    QMember member = QMember.member;
    QMission mission = QMission.mission;

  
    //@override
    public List<UmpThirdDTO> thirdpictureWithCursor(int phoneNumber, LocalDateTime cursorCreatedAt) {

        BooleanBuilder predicate = new BooleanBuilder();

        if (phoneNumber != 0) {
            predicate.and(member.phoneNumber.eq(phoneNumber));
        }
        //ph ê°€oneNumberì™€ ê°™ì€ ê°’ì„ì§„ Memberì™€ ì—°ê´€ëœ UserMissionPointcounter(ump) ë ˆì½”ë“œë§Œ ì¡°íšŒë©ë‹ˆë‹¤.
        if (cursorCreatedAt != null) {
            predicate.and(ump.createdAt.lt(cursorCreatedAt)); // ì»¤ì„œ ì¡°ê±´ : "í˜„ì¬ ì»¤ì„œ ì‹œì ë³´ë‹¤ ë” ê³¼ê±°ì˜ ë°ì´í„°ë§Œ ê°€ì ¸ì˜¨ë‹¤."
        }

        return jpaQueryFactory
                .select(Projections.constructor(UmpThirdDTO.class, ump.completedMission, mission.missionid, mission.createdAt))
                .from(ump)
                .join(ump.mission, mission).on(mission.missionid.eq(ump.mission.missionid))
                .where(predicate)
                .orderBy(ump.createdAt.desc())
                .limit(20)
                .fetch();
    }
}
```

![ë§ˆì´ í˜ì´ì§€ í™”ë©´ ì¿¼ë¦¬](Untitled%203.png)

ë§ˆì´ í˜ì´ì§€ í™”ë©´ ì¿¼ë¦¬

2ì£¼ì°¨ ì¿¼ë¦¬ë¬¸

SELECT m.nickname, m.phone_number, m.email, ump.total_point, rv.review_name, cm.title FROM member m
JOIN user_mission_pointcounter ump ON m.phone_number=ump.phone_number
JOIN review rv ON m.phone_number=rv.phone_number
JOIN cmr cm ON m.phone_number=cm.phone_number;

---

ì¿¼ë¦¬dsl

```java
package umc.study.repository.MemberRepository;

import com.querydsl.core.types.Projections;
import com.querydsl.jpa.impl.JPAQueryFactory;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Repository;
import umc.study.domain.QMember;
import umc.study.domain.mapping.QReview;
import umc.study.domain.mapping.QUserMissionPointcounter;
import umc.study.domain.QCrm;
import umc.study.dto.MemberDetailDTO;

import java.util.List;

@Repository
@RequiredArgsConstructor
public class MemberRepositoryImpl implements MemberRepositoryCustom{
    QUserMissionPointcounter ump = QUserMissionPointcounter.userMissionPointcounter;
    QReview rv = QReview.review;
    QCrm cm = QCrm.crm;

    private final JPAQueryFactory jpaQueryFactory;
    private final QMember member  = QMember.member;

    public List<MemberDetailDTO> fourthpicture(String nickname, int phonenumber,
                                               String email, int totalpoint, String reviewName, String crmTitle){

        return jpaQueryFactory.select(Projections.bean(MemberDetailDTO.class,
                        member.nickname,
                        member.phoneNumber,
                        member.email,
                        ump.totalPoint,
                        rv.reviewId,
                        cm.title  // DTOì˜ í•„ë“œëª…ê³¼ ë‹¤ë¥´ë©´ as()ë¡œ ë§ì¶°ì•¼ í•¨
                ))
                .from(member, cm, rv, ump)
                .join(ump).on(member.phoneNumber.eq(ump.member.phoneNumber))
                .join(rv).on(member.phoneNumber.eq(rv.member.phoneNumber))  // review í…Œì´ë¸”ê³¼ JOIN
                .join(cm).on(member.phoneNumber.eq(cm.member.phoneNumber))  // cmr í…Œì´ë¸”ê³¼ JOIN
                .fetch();

    }
}

```

# ğŸ’ªÂ ë¯¸ì…˜ ê¸°ë¡

---

<aside>
ğŸ€ ë¯¸ì…˜ ê¸°ë¡ì˜ ê²½ìš°, ì•„ë˜ ë¯¸ì…˜ ê¸°ë¡ í† ê¸€ ì†ì— ì‘ì„±í•˜ì‹œê±°ë‚˜, í˜ì´ì§€ë¥¼ ìƒˆë¡œ ìƒì„±í•˜ì—¬ í•´ë‹¹ í˜ì´ì§€ì— ê¸°ë¡í•˜ì—¬ë„ ì¢‹ìŠµë‹ˆë‹¤!

í•˜ì§€ë§Œ, ê²°ê³¼ë¬¼ë§Œ ì˜¬ë¦¬ëŠ” ê²ƒì´ ì•„ë‹Œ, **ì¤‘ê°„ ê³¼ì • ëª¨ë‘ ê¸°ë¡í•˜ì…”ì•¼ í•œë‹¤ëŠ” ì !** ìŠì§€ ë§ì•„ì£¼ì„¸ìš”.

</aside>

- **ë¯¸ì…˜ ê¸°ë¡**
    
    ë§‰íˆëŠ” ë¶€ë¶„ë“¤ë§Œ ë”°ë¡œ ì •ë¦¬
    
    íí´ë˜ìŠ¤ : ì—”í‹°í‹° í´ë˜ìŠ¤ ì†ì„±ê³¼ êµ¬ì¡°ë¥¼ ì„¤ëª…í•´ì£¼ëŠ” **ë©”íƒ€ë°ì´í„°**ë¡œ Type-safe í•˜ê²Œ í€´ë¦¬ ì¡°ê±´ ì„¤ì • ê°€ëŠ¥
    **ê¸°ë³¸ì ìœ¼ë¡œ** Spring Boot JPAì—ì„œ Querydslì„ ì‚¬ìš©í•˜ì—¬ ì¿¼ë¦¬ë¬¸ì„ ë§Œë“¤ ë•ŒëŠ” **í•´ë‹¹ ì—”í‹°í‹°ì— ëŒ€í•´ ìƒì„±ëœ Q í´ë˜ìŠ¤ì— ì •ì˜ëœ ë©”ì†Œë“œì™€ í•„ë“œê°’ë§Œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì›ì¹™**ì´ë‹¤.
    
    BooleanBuilder : ë™ì ì¿¼ë¦¬ë¥¼ ë§Œë“¤ê¸° ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬
    
    JPA ë ˆí¬ì§€í† ë¦¬ ì„ ì–¸ -> JPAì¿¼ë¦¬íŒ©í† ë¦¬ ë¹ˆ ë“±ë¡ -> ì»¤ìŠ¤í…€ ë ˆí¬ì§€í† ë¦¬ ì¸í„°í˜ì´ìŠ¤ ìƒì„±(ì—¬ê¸°ì„œ ì¿¼ë¦¬ dslë¡œ ìˆ˜í–‰í•  ë©”ì†Œë“œë“¤ì„ ì„ ì–¸í•´ì¤˜ì•¼í•œë‹¤) -> ì „ ë‹¨ê³„ì—ì„œ ì»¤ìŠ¤í…€ ë ˆí¬ì§€í† ë¦¬ì— + Impl ì„ ë¶™ì—¬ì„œ ì»¤ìŠ¤í…€ ë ˆí¬ì§€í† ë¦¬ì„í”Œ í´ë˜ìŠ¤ë¥¼ êµ¬í˜„í•´ì•¼í•œë‹¤ ì´ í´ë˜ìŠ¤ëŠ” ì»¤ìŠ¤í…€ ë ˆí¬ì§€í† ë¦¬ë¥¼ ì¸í„°í˜ì´ìŠ¤ë¡œ ê°–ëŠ”ë‹¤. -> ì‚¬ìš©í•  JPA ë ˆí¬ì§€í„°ë¦¬ ìˆ˜ì •
    
    ì²˜ìŒ ë§Œë“  JPA ë ˆí¬ì§€í† ë¦¬ì—
    package umc.study.repository.StoreRepository; import com.querydsl.core.BooleanBuilder; import com.querydsl.jpa.impl.JPAQueryFactory; import lombok.RequiredArgsConstructor; import org.springframework.stereotype.Repository; import umc.study.domain.QStore; import umc.study.domain.Store; import java.util.List;
    @Repository
    @RequiredArgsConstructor
    public class StoreRepositoryImpl implements StoreRepositoryCustom{
    private final JPAQueryFactory jpaQueryFactory; private final QStore store = QStore.store;
    
    @Override public List<Store> dynamicQueryWithBooleanBuilder(String name, Float score) { BooleanBuilder predicate = new BooleanBuilder();
    if (name != null) { predicate.and(store.name.eq(name)); }
    if (score != null) { predicate.and(store.score.goe(4.0f)); }
    return jpaQueryFactory
    .selectFrom(store)
    .where(predicate)
    .fetch();
    
    }
    }
    ë¥¼ ì‘ì„±í•¨ìœ¼ë¡œ ì¿¼ë¦¬ë¬¸ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
    
    BooleanBuilderë¥¼ í†µí•´ì„œ ifë¬¸ì— ìˆëŠ” JPAí™”ëœ ë‚´ìš©ë“¤ì„ SQLë¬¸ìœ¼ë¡œ ë²ˆì—­í•´ì£¼ëŠ” ì—­í• ì´ë‹¤. ì¦‰ BooleanBuilderë¥¼ í†µí•´ì„œ whereì„ êµ¬í˜„í•  ìˆ˜ìˆë‹¤
    
    select ì ˆì€ íí´ë˜ìŠ¤ì— ë“¤ê³  ìˆëŠ” í•„ë“œë¥¼ ë„£ì–´ì£¼ê³  ì´ê²ƒì„ ì–´ë””ì— ì¡°íšŒë¥¼ í•  ê²ƒì¸ì§€ì— ëŒ€í•œ íí´ë˜ìŠ¤ë¥¼ ë„£ì–´ì£¼ë©´ ëœë‹¤.
    
    whereì¡°ê±´ì—ëŠ” íí´ë˜ìŠ¤ì—ì„œ ë§Œë“  ë©”ì†Œë“œë“¤ê³¼ í•„ë“œë“¤ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
    
    ê²°ê³¼ ì¡°íšŒ ë©”ì†Œë“œ
    .fetchOne() : return Store => í•˜ë‚˜ì˜ ê²°ê³¼ ê°’ì„ ê°€ì ¸ì˜¤ê³  ì‹¶ì„ë•Œ
    .fetch() : return List<Store>  => ì˜ˆë¥¼ ë“¤ì–´ ë¦¬ìŠ¤íŠ¸ì™€ ê°™ì€ í˜•íƒœì˜ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê³  ì‹¶ì„ë•Œ
    .fetchFirst() : limit(1).fetchOne() => fetchOne()ê³¼ ë™ì¼ í•˜ì§€ë§Œ ë§¨ ì•ë‹¨ì— ë¦¬ë°‹ì„ ë¶™ì—¬ì¤€ ê²ƒê³¼ ë™ì¼í•˜ë‹¤
    
    ì—¬ê¸°ì„œ ì¡°ì¸ë„ ê°€ëŠ¥í•œë°
    ì—°ê´€ê´€ê³„ê°€ ì—†ëŠ” í…Œì´ë¸”ê°„ ì¡°ì¸ì€ ì¹´í…Œì‹œì•ˆ ê³±ì´ ë°œìƒí•˜ê¸°ì— ì£¼ì˜í•´ì•¼í•œë‹¤
    innerì¡°ì¸ì˜ ê²½ìš° onì´ë‚˜ whereì´ë‚˜ ê°™ì€ ë™ì‘ì„ í•œë‹¤.
    
    if (name != null) {
    predicate.and(store.name.eq(name));
    }
    
    if (score != null) {
    predicate.and(store.score.goe(score));
    }
    
    if (city != null) {
    predicate.and(store.city.eq(city));
    }
    
    if (isOpen != null) {
    predicate.and(store.isOpen.eq(isOpen));
    }
    => sqlë¬¸ìœ¼ë¡œ ë°”ë€Œë©´
    
    WHERE name = 'xxx'
    AND score >= 4.0
    AND city = 'Seoul'
    AND is_open = true
    ì´ëŸ° í˜•ì‹ì´ë‹¤.
    N+1 ë¬¸ì œ í•´ê²°í• ë ¤ê³  JPQLì„ ì‚¬ìš©í•˜ëŠ” ì´ìœ ë‹¤
    ì¿¼ë¦¬dslì€ fetchJoin()ì´ë¼ëŠ” ë©”ì†Œë“œë¥¼ ì œê³µí•˜ê¸°ì— ì´ë¥¼ í†µí•´ì„œ N+1ë¬¸ì œë¥¼ í•´ê²° í•  ìˆ˜ìˆë‹¤.
    
    2ê°œ ì‚¬ì˜ OnetoMany ê´€ê³„ì—ì„œëŠ” ì—°ì†ëœ fetchjoin()ì´ ë¶ˆê°€ëŠ¥í•˜ë‹¤.
    
    JPAQuery
    ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ì¿¼ë¦¬ë¬¸ ìƒì„± ì‚¬ìš©ë²”ìœ„ê°€ ë„“ë‹¤
    
    ì„œë¸Œì¿¼ë¦¬ ì‘ì„±ë²•
    JPAExpressions ìœ í‹¸ì„± í´ë˜ìŠ¤, ë‹¤ì–‘í•œ select ë©”ì„œë“œ ì§€ì›, ì‚¬ìš© ë²”ìœ„ê°€ ì„œë¸Œ ì¿¼ë¦¬ì— ë” ë§ì¶°ì ¸ ìˆìŒ
    
    dynamicQueryWithBooleanBuilderì˜ íŒŒë¼ë¯¸í„°ëŠ” í•´ë‹¹ í…Œì´ë¸”ì˜ ì»¬ëŸ¼ ê°’ì´ë‹¤ ì—¬ê¸°ì„œ ì¡°ì¸ëœ í…Œì´ë¸”ì˜ ì»¬ëŸ¼ì„ ì¶”ê°€í•˜ê¸° ìœ„í•´ì„œ
    íí´ë˜ìŠ¤.ì»¬ëŸ¼ëª… = ì»¬ëŸ¼ëª…; í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•˜ì—¬
    dynamicQueryWithBooleanBuilderì˜ íŒŒë¼ë¯¸í„°ì— ë„£ì–´ì•¼í•œë‹¤.
    
    `@NoArgsConstructor` ì–´ë…¸í…Œì´ì…˜ì€ **Lombok** ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ ì œê³µí•˜ëŠ” ì–´ë…¸í…Œì´ì…˜ ì¤‘ í•˜ë‚˜ë¡œ, **ë§¤ê°œë³€ìˆ˜ê°€ ì—†ëŠ” ê¸°ë³¸ ìƒì„±ì(default constructor)**ë¥¼ ìë™ìœ¼ë¡œ ìƒì„±í•´ì¤ë‹ˆë‹¤.
    
    ì¿¼ë¦¬ë¥¼ QueryDSLë¡œ ì‘ì„±í•˜ì—¬ ë¦¬íŒ©í† ë§í•œë‹¤ë©´ ì–´ë–»ê²Œí•´
    
    - ê°€ë…ì„± í–¥ìƒ
    - íƒ€ì… ì•ˆì •ì„± í™•ë³´ (ì»´íŒŒì¼ íƒ€ì„ ì˜¤ë¥˜ íƒì§€)
    - DTO ë§¤í•‘
    - ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ
    // dsl ì‘ì„±ì‹œ DTOì˜ í•„ë“œëª…ê³¼ ë‹¤ë¥´ë©´ as()ë¡œ ë§ì¶°ì•¼ í•¨
    
    DTOì—ì„œ `enum` íƒ€ì…ì€ **ê·¸ëŒ€ë¡œ `Enum` íƒ€ì…ìœ¼ë¡œ ì„ ì–¸**í•˜ë©´ ë˜ê³ , QueryDSLì—ì„œë„ **ì§ì ‘ ë§¤í•‘ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.**
    
    í•˜ë‚˜ì˜ DTOì— ëª¨ë“  í•„ë“œë¥¼ í¬í•¨ (ë¹„ì¶”ì²œ)
    
    ëª¨ë“  í•„ë“œë¥¼ í•˜ë‚˜ì˜ DTOì— ë„£ëŠ” ë°©ì‹ë„ ê°€ëŠ¥ì€ í•˜ì§€ë§Œ,
    
    **ë¶ˆí•„ìš”í•œ í•„ë“œê°€ nullë¡œ ì±„ì›Œì§€ê³  ìœ ì§€ë³´ìˆ˜ê°€ ì–´ë ¤ì›Œì ¸ì„œ ë¹„íš¨ìœ¨ì **ì…ë‹ˆë‹¤
    DTOëŠ” select ëŒ€ìƒì— ë§ê²Œ ê°œë³„ ì„¤ê³„í•˜ëŠ” ê²ƒì´ ìµœì„ ì…ë‹ˆë‹¤.
    
    ê°™ì€ í…Œì´ë¸” ë ˆí¬ì§€í† ë¦¬ì—ì„œ ë©”ì†Œë“œë¥¼ ë”°ë¡œ ì„¤ì •í•¨ìœ¼ë¡œ ì—¬ëŸ¬ ì¿¼ë¦¬dsl êµ¬í˜„ì´ ê°€ëŠ¥í•˜ë‹¤.
    
    DTOì—ì„œ
    @Data
    
    @AllArgsConstructor
    
    @NoArgsConstructor
    í•´ë‹¹ ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•¨ìœ¼ë¡œ ìƒì„±ìë¥¼ ìŠ¤í”„ë§ë¶€íŠ¸ì—ì„œ ë§Œë“¤ì–´ì¤Œìœ¼ë¡œ ì‚¬ìš©ê°€ëŠ¥í•˜ë‹¤ ì—¬ê¸°ì„œ ì£¼ì˜í•  ì ì€ DTOí´ë˜ìŠ¤ë¥¼ ì¿¼ë¦¬dslì—ì„œ ì‚¬ìš©ì‹œ Projections.bean()ì„ ì‚¬ìš©í•´ì„œ êµ¬í˜„í•˜ëŠ”ë° ()ì•ˆì— ë“¤ì–´ê°€ëŠ” íŒŒë¼ë¯¸í„°ì˜ ìˆœì„œë‘ DTOí´ë˜ìŠ¤ì—ì„œ ì‘ì„±í•œ í•„ë“œ ìˆœì„œê°€ ê°™ì•„ì•¼í•œë‹¤.
    
    predicate.and([ump.createdAt.lt](http://ump.createdat.lt/)(cursorCreatedAt));
    í•´ì„ :
    
    - `predicate`: `BooleanBuilder` ê°ì²´ì…ë‹ˆë‹¤. `where` ì ˆì— ë“¤ì–´ê°ˆ ì¡°ê±´ë“¤ì„ ëˆ„ì í•´ì„œ ìŒ“ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.
    - `ump.createdAt`: `UserMissionPointcounter` ì—”í‹°í‹°ì˜ `createdAt` í•„ë“œ (ìƒì„± ì‹œê°).
    - `lt(...)`: "less than" (ì‘ë‹¤)ë¥¼ ì˜ë¯¸í•˜ëŠ” ë©”ì„œë“œì…ë‹ˆë‹¤.
    - `cursorCreatedAt`: íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬ëœ ê¸°ì¤€ ì‹œê°„ì…ë‹ˆë‹¤ (ì˜ˆ: í˜ì´ì§€ë„¤ì´ì…˜ì˜ ì»¤ì„œ ì—­í• ).
    
    [ì‹œë‹ˆì–´ ë¯¸ì…˜](https://www.notion.so/1e7b57f4596b812d944afe17d10b427d?pvs=21)
    

## âš¡ íŠ¸ëŸ¬ë¸” ìŠˆíŒ…

---

<aside>
ğŸ’¡ ì‹¤ìŠµí•˜ë©´ì„œ ìƒê¸´ ë¬¸ì œë“¤ì— ëŒ€í•´ì„œ, **ì´ìŠˆ - ë¬¸ì œ - í•´ê²°** ìˆœì„œë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”.

</aside>

<aside>
ğŸ’¡ ìŠ¤ìŠ¤ë¡œ í•´ê²°í•˜ê¸° ì–´ë µë‹¤ë©´? ìŠ¤í„°ë””ì›ë“¤ì—ê²Œ ë„ì›€ì„ ìš”ì²­í•˜ê±°ë‚˜ **ë„ˆë””ë„ˆë¦¬ì˜ ì§€ì‹IN ì±„ë„ì— ì§ˆë¬¸**í•´ë³´ì„¸ìš”!

</aside>

- âš¡ì´ìŠˆ ì‘ì„± ì˜ˆì‹œ (ì´ìŠˆê°€ ìƒê¸°ë©´ ì•„ë˜ë¥¼ ë³µì‚¬í•´ì„œ No.1, No.2, No3 â€¦ ìœ¼ë¡œ ì‘ì„±í•´ì„œ íŠ¸ëŸ¬ë¸” ìŠˆíŒ…ì„ ê¼­ í•´ë³´ì„¸ìš”!)
    
    **`ì´ìŠˆ`**
    
    ğŸ‘‰ ì•± ì‹¤í–‰ ì¤‘ì— ë…¸ë˜ ë‹¤ìŒ ë²„íŠ¼ì„ ëˆ„ë¥´ë‹ˆê¹Œ ì•±ì´ ì¢…ë£Œë˜ì—ˆë‹¤.
    
    **`ë¬¸ì œ`**
    
    ğŸ‘‰ ë…¸ë˜í´ë˜ìŠ¤ì˜ ë°ì´í„°ë¦¬ìŠ¤íŠ¸ì˜ Sizeë¥¼ ë„˜ì–´ì„œ NullPointExceptionì´ ë°œìƒí•˜ì—¬ ì•±ì´ ì¢…ë£Œëœ ê²ƒì´ì—ˆë‹¤. 
    
    **`í•´ê²°`**
    
    ğŸ‘‰  ë…¸ë˜ ë‹¤ìŒ ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ ë°ì´í„°ë¦¬ìŠ¤íŠ¸ì˜ Sizeë¥¼ ê²€ì‚¬í•´ Sizeë³´ë‹¤ ë„˜ì–´ê°€ë ¤ê³  í•˜ë©´ ë‹¤ìŒìœ¼ë¡œ ë„˜ì–´ê°€ëŠ” ë©”ì„œë“œë¥¼ ì‹¤í–‰ì‹œí‚¤ì§€ ì•Šê³ , ì²« ë…¸ë˜ë¡œ ëŒì•„ê°€ê²Œë” í•´ê²°
    
    **`ì°¸ê³ ë ˆí¼ëŸ°ìŠ¤`**
    
    - ë§í¬
- âš¡ì´ìŠˆ No.1
    
    **`ì´ìŠˆ`**
    
    ğŸ‘‰ [íŠ¸ëŸ¬ë¸”ì´ ìƒê¸´ ìƒíƒœ ì‘ì„±]
    
    **`ë¬¸ì œ`**
    
    ğŸ‘‰ [ì–´ë–¤ ì´ìœ ë¡œ í•´ë‹¹ ì´ìŠˆê°€ ì¼ì–´ë‚¬ëŠ”ì§€ ì‘ì„±]
    
    **`í•´ê²°`**
    
    ğŸ‘‰  [í•´ê²° ë°©ë²• ì‘ì„±]
    
    **`ì°¸ê³ ë ˆí¼ëŸ°ìŠ¤`**
    
    - [ë¬¸ì œ í•´ê²° ì‹œ ì°¸ê³ í•œ ë§í¬]

## ğŸ¤”Â ì°¸ê³  ìë£Œ

---

Copyright Â© 2025 ì‹ ìˆ˜ì •(ë² ë‰´) All rights reserved.