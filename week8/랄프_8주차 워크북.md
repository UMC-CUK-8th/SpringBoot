# 시니어 미션

---

## 1. @DynamicInsert?? @DynamicUpdate??

### 들어가기전 …

스프링 JPA 를 사용 시 영속성 컨텍스트라는 논리적인 공간을 이용하는데 데이터베이스에 등록하거나 데이터베이스에 있는 엔티티를 수정할 때 JPA 기본전략 엔티티의 모든 필드를 업데이트 하는 방식으로 이뤄짐. 

→ 즉 특정 필드 값이 등록되거나 수정되지 않아도 JPA가 쿼리를 날릴 시 null 값으로 보낸게 됨.

근데 그럼 우리가 의문점이 들거임

> 왜 JPA 구현체는 불필요하게 모든 필드를 업데이트할까??
> 

이러면 DB에 보내지는 데이터 전송량이 증가해서 안좋을건데…

장점은 다음과 같다

- 모든 필드를 사용하면 바인딩 되는 데이터만 다를 뿐 등록, 수정 쿼리가 항상 같다
    - 따라서 어플리케이션 로딩 시점에 쿼리를 미리 생성해두고 재사용 가능
- 데이터베이스에 동일한 쿼리를 보내면 데이터베이스는 이전에 한 번 파싱된 쿼리를 재사용가능

결론은 단점보단 장점이 많아서 쓰인다고 한다

하지만 원하지 않을 때 어떻게 할까??? 바로 다음과 같은 어노테이션을 엔티티에 적용하면 된다.

### @DynamicInsert

이 어노테이션을 엔티티에 적용하게 되면 Insert 쿼리를 날릴 때 Null 인값은 제외하고 쿼리문이 만들어짐.

### @DynamicUpdate

이 어노테이션을 엔티티에 적용하게 되면 Update 쿼리를 날릴 때 null인 값은 제외하고 쿼리문이 만들어진다.

> 필드가 많아질수록 속도면에서 차이가 날 것이다!!
> 

몇 개의 필드만 자주 수정하거나 필드가 많을 경우에 사용하면 될 거 같음.

참고: https://record1996.tistory.com/23

https://velog.io/@yesrin/DynamicInsert-DynamicUpdate%EB%8A%94-%EC%99%9C-%EC%82%AC%EC%9A%A9%ED%95%A0%EA%B9%8C

---

## 2. Rest Docs?

: Spring으로 개발된 REST API 를 자동으로 문서화 해주는 도구

- Asciidoctor를 기반으로 사용하여 HTML , PDF 등 다양한 포맷으로 문서를 자동 출력 가능
- 테스트 코드를 기반으로 문서를 작성하므로 실제 운영 코드에 추가작업 필요x
- 테스트 빌드가 성공해야만 문서가 작성되기 때문에 검증된 문서를 보장할 수 있음.

근데 내가 해본 바로는 문서조각을 우리가 직접 합쳐줘야하고 직접 테스트도 못해봄.

그리고 사바사 이긴하지만 가독성이 클라이언트에게 친화적이지 못하는 평을 받고 있음.

### 그럼 Swagger는?

Swagger는 API 를 테스트해 볼 수 있는 화면을 제공하여 동작 테스트에 좀 더 특화되어 있는 문서화 도구

- 실제 운영중인 코드에 문서화를 위한 어노테이션 코드를 직접 추가해야 함.
- 문서화용 코드를 계속 사용하다보면 기능에 불필요한 코드로 인해 코드가 길어지고 가독성이 떨어짐.
- REST Docs와 다르게 테스트 코드 기반이 아니기에 100% 정확한 문서라고 확신을 할 순 없음.

개인적으로 프로덕트 코드에 어노테이션들이 덕지덕지 붙어있는 것도 싫긴하다.

### Rest Docs + Swagger!!!!!!!

그래서 찾아보니 하이브리드로 쓰는 방법이 있다고 함

<방법>

1. 기존처럼 테스트 코드를 통해 docs 문서를 생성
2. docs 문서를 OpenAPI3 스펙으로 변환
3. 만들어진 OpenAPI3 스펙을 SwaggerUI로 생성
4. 생성된 SwaggerUI를 static 패키지에 복사 및 정적리소스로 배포

사실 실제로 안해봤는데 삽질이 많이 필요한 작업일 거 같아 미래의 나에게 맡기겠다.